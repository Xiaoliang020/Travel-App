"use strict";(self.webpackChunktravel_app=self.webpackChunktravel_app||[]).push([[941],{868:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var o=n(1413),r=n(3433),a=n(4165),l=n(5861),s=n(9439),c=n(2791),i=n(7993),u=(n(3508),n(7027)),d=n(7175),p=n(2958),f=n(6005),g=n(7309),h=n(5925),m=n(1431),y=n(1913),x=n(6739),Z=n(9286),v=n(1515),k=n(2273),j=n(1891),w=n(8272),T=n(4215),C=n(2056),b=n(2365),S=n(9951),P=n(5498),L=n.n(P),I=n(3883),E=n(7106),A=n(1243),O=(n.p,n(8533)),D=n(6641),R={fullscreenControl:!1,streetViewControl:!1,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]},z=n(184);function F(){var e=(0,c.useState)([]),t=(0,s.Z)(e,2),n=t[0],P=t[1],F=(0,c.useState)(!1),N=(0,s.Z)(F,2),B=N[0],G=N[1],M=(0,c.useState)(0),q=(0,s.Z)(M,2),W=q[0],Y=q[1],_=(0,c.useState)([]),J=(0,s.Z)(_,2),U=J[0],V=J[1],H=(0,c.useState)({lat:null,lng:null}),K=(0,s.Z)(H,2),X=K[0],Q=K[1],$=(0,c.useState)(!0),ee=(0,s.Z)($,2),te=ee[0],ne=ee[1],oe=(0,c.useState)(null),re=(0,s.Z)(oe,2),ae=re[0],le=re[1],se=(0,c.useState)(14),ce=(0,s.Z)(se,2),ie=ce[0],ue=ce[1],de=(0,c.useState)(null),pe=(0,s.Z)(de,2),fe=pe[0],ge=pe[1],he=(0,c.useState)(null),me=(0,s.Z)(he,2),ye=me[0],xe=me[1],Ze=(0,c.useState)(1),ve=(0,s.Z)(Ze,2),ke=ve[0],je=ve[1],we="https://travel-app.online:8443",Te=(0,c.useRef)(""),Ce=(0,c.useRef)(""),be=(0,c.useRef)(""),Se=(0,c.useRef)(""),Pe=(0,c.useState)(!1),Le=(0,s.Z)(Pe,2),Ie=Le[0],Ee=(Le[1],(0,c.useState)()),Ae=(0,s.Z)(Ee,2),Oe=Ae[0],De=(Ae[1],(0,c.useContext)(y.Z)),Re=De.addPath,ze=De.displayedPath,Fe=De.setDisplayedPath,Ne=(0,c.useContext)(x.N).theme,Be=function(e){return new Promise((function(t,n){var o=new FileReader;o.readAsDataURL(e),o.onload=function(){return t(o.result)},o.onerror=function(e){return n(e)}}))},Ge=(0,c.useState)(!1),Me=(0,s.Z)(Ge,2),qe=(Me[0],Me[1]),We=(0,c.useState)(""),Ye=(0,s.Z)(We,2),_e=(Ye[0],Ye[1]),Je=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(t){var n,o,r,l,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.file,o=t.onSuccess,r=t.onError,e.prev=1,(l=new FormData).append("file",n),e.next=6,A.Z.post("".concat(we,"/api/upload-icon"),l);case 6:"0"===(s=e.sent).data.code?(console.log("Icon uploaded successfully:",s.data),console.log(s.data.data),be.current=s.data.data,console.log(be.current),o()):r(new Error("Failed to upload icon")),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error uploading avatar:",e.t0),r(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),Ue=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.url||t.preview){e.next=4;break}return e.next=3,Be(t.originFileObj);case 3:t.preview=e.sent;case 4:_e(t.url||t.preview),qe(!0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ve=(0,i.Db)({googleMapsApiKey:"AIzaSyA1ythArpYzyCd9fOmJ9c3iIXCB83eAnfE"}).isLoaded,He=(0,c.useState)(!1),Ke=(0,s.Z)(He,2),Xe=Ke[0],Qe=Ke[1],$e=(0,z.jsxs)("div",{children:[Ie?(0,z.jsx)(E.Z,{}):(0,z.jsx)(Z.Z,{}),(0,z.jsx)("div",{style:{marginTop:8},children:"Upload"})]}),et=function(e){"done"===e.file.status?u.ZP.success("".concat(e.file.name," uploaded successfully")):"error"===e.file.status&&u.ZP.error("".concat(e.file.name," upload failed."))};function tt(){return new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){var n=t.coords,o=n.latitude,r=n.longitude;e({latitude:o,longitude:r})}),(function(e){t(e)}))}))}function nt(e){return ot.apply(this,arguments)}function ot(){return ot=(0,l.Z)((0,a.Z)().mark((function e(t){var n,o,l,s,c,i,u,d,p,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout((function(){e()}),1e3)}));case 2:return e.next=4,tt();case 4:return n=e.sent,o=n.latitude,l=n.longitude,console.log({firstLat:o,firstLng:l}),e.next=10,new Promise((function(e){setTimeout((function(){e()}),1e3)}));case 10:return e.next=12,tt();case 12:return s=e.sent,c=s.latitude,i=s.longitude,console.log({secondLat:c,secondLng:i}),e.next=18,new Promise((function(e){setTimeout((function(){e()}),1e3)}));case 18:return e.next=20,tt();case 20:u=e.sent,d=u.latitude,p=u.longitude,console.log({thirdLat:d,thirdLng:p}),f={latitude:(o+c+d)/3,longitude:(l+i+p)/3},P((function(e){return[].concat((0,r.Z)(e),[{lat:f.latitude,lng:f.longitude,type:"default",pathId:t}])})),Q({lat:f.latitude,lng:f.longitude}),console.log(f),xe(new Date);case 29:case"end":return e.stop()}}),e)}))),ot.apply(this,arguments)}(0,c.useEffect)((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){le({lat:e.coords.latitude,lng:e.coords.longitude})}),(function(e){console.error("Error retrieving geolocation:",e),le({lat:40.7128,lng:-74.006})})):le({lat:40.7128,lng:-74.006})}),[]),(0,c.useEffect)((function(){ze&&ze.length>0?(le(ze[0]),ue(15)):n.length>0&&le(n[n.length-1])}),[ze,n]),(0,c.useEffect)((function(){var e;return B&&(ge(new Date),navigator.geolocation.getCurrentPosition((function(e){var t=e.coords,n=t.latitude,o=t.longitude;P((function(e){return[].concat((0,r.Z)(e),[{lat:n,lng:o,type:"default",pathId:W}])})),Q({lat:n,lng:o}),console.log("Got first location after click the button")}),(function(e){console.error("Error retrieving geolocation:",e)})),e=setInterval((0,l.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Start Marking"),e.next=3,nt(W);case 3:console.log("Get a location"),console.log(W);case 5:case"end":return e.stop()}}),e)}))),8e3)),function(){return clearInterval(e)}}),[B,W]);I.Z.setApiKey("AIzaSyA1ythArpYzyCd9fOmJ9c3iIXCB83eAnfE");var rt=n.reduce((function(e,t){return(e[t.pathId]=e[t.pathId]||[]).push(t),e}),{}),at=function(){ne(!te)},lt=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Qe(!0),t=document.querySelector(".map-container"),L()(t,{useCORS:!0,allowTaint:!0}).then((function(e){var t=document.createElement("a");t.href=e.toDataURL("image/png"),t.download="screenshot.png",t.click(),Qe(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Qe(!0),t=document.querySelector(".map-container"),L()(t,{useCORS:!0,allowTaint:!0}).then((function(e){e.toBlob((function(e){if(e){var t=new File([e],"screenshot.png",{type:"image/png"});navigator.share?navigator.share({files:[t]}):console.error("Web Share API not supported.")}else console.error("Failed to generate screenshot blob.");Qe(!1)}))}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Ve?(0,z.jsx)("div",{className:"map-view",children:(0,z.jsxs)("div",{className:"map-container",children:[(0,z.jsxs)(i.b6,{center:ae,zoom:ie,mapContainerClassName:"map-container",options:(0,o.Z)({fullscreenControl:!1,streetViewControl:!1},"default"===Ne?{}:R),children:[te&&Object.values(rt).map((function(e,t){return(0,z.jsx)(i.dp,{path:e,options:{strokeColor:"#0000FF",strokeOpacity:1,strokeWeight:5}},t)})),ze&&te&&(0,z.jsx)(i.dp,{path:ze,options:{strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5}}),U.map((function(e,t){return(0,z.jsx)(i.jC,{position:{lat:e.markerLat,lng:e.markerLng},visible:"custom"===e.type,icon:e.url,onClick:function(){return function(e){console.log("marker text is:"+e.text),d.Z.confirm({title:"The comment you left in this place",content:(0,z.jsxs)("div",{children:[(0,z.jsx)(D.Z,{showCount:!0,maxLength:200,style:{heght:250,marginBottom:24},placeholder:"Input something...",defaultValue:e.text,onChange:function(e){return Ce.current=e.target.value}}),"Pictures:",(0,z.jsxs)(O.Z,{children:[(0,z.jsx)(p.Z,{listType:"picture-card",onPreiew:Ue,onChange:et}),Oe?(0,z.jsx)("img",{src:Oe,alt:"avatar",style:{width:"100%"}}):$e]})]}),onOk:function(t){var n={lat:e.lat,lng:e.lng,type:"custom",id:e.id,name:e.name,text:Ce.current,icon:e.icon};V(U.map((function(t){return t===e?n:t}))),t()}})}(e)}},e)}))]}),(0,z.jsx)("div",{className:"map-view-start-stop-button",children:B?(0,z.jsx)(g.ZP,{type:"primary",shape:"round",size:"large",onClick:function(){G(!1),console.log("Stop tracking");var e=(ye-fe)/1e3;e<10?d.Z.warning({centered:!0,title:"Warning",content:"The path is less than 10 seconds long and will not be saved."}):d.Z.confirm({centered:!0,title:"Do you want to save this path?",content:(0,z.jsxs)("div",{children:[(0,z.jsx)("p",{children:"Enter a name for the path:"}),(0,z.jsx)(f.Z,{onChange:function(e){Te.current=e.target.value},placeholder:"Path name"})]}),onOk:function(){console.log(Te);var t=n[0],r=n[n.length-1],a=JSON.parse(sessionStorage.getItem("user"));I.Z.fromLatLng(t.lat,t.lng).then((function(t){var l=t.results[0].formatted_address;I.Z.fromLatLng(r.lat,r.lng).then((function(t){var r=t.results[0].formatted_address,s={path:n,startTime:fe,endTime:ye,duration:e,startAddress:l,endAddress:r,userid:a.id,name:Te.current};console.log("PathData",s),A.Z.post("".concat(we,"/api/path-data"),s).then((function(e){"0"===e.data.code&&console.log("Path data successfully sent to the backend:",e.data),console.log(e.data.data),U.map((function(t){return(0,o.Z)((0,o.Z)({},t),{},{pathID:e.data.data})})).forEach((function(e){console.log(e),A.Z.post("".concat(we,"/api/marker-data"),e).then((function(e){"0"===e.data.code&&console.log("Marker data successfully sent to backend:",e.data)})).catch((function(e){console.log("Error sending marker data to the backend:",e)}))}))})).catch((function(e){console.error("Error sending path data to the backend:",e)})),Re(s)})).catch((function(e){console.error("Error geocoding end coordinates:",e)}))})).catch((function(e){console.error("Error geocoding start coordinates:",e)}))}})},icon:(0,z.jsx)(v.Z,{}),style:{backgroundColor:"OrangeRed"},children:"STOP"}):(0,z.jsx)(g.ZP,{type:"primary",shape:"round",size:"large",onClick:function(){P([]),V([]),G(!0),Y((function(e){return e+1})),console.log("Start tracking")},icon:(0,z.jsx)(k.Z,{}),style:{backgroundColor:"LimeGreen"},children:"START"})}),(0,z.jsxs)(h.Z.Group,{shape:"circle",style:{left:24},children:[(0,z.jsx)(m.Z,{title:(0,z.jsxs)("div",{children:[(0,z.jsx)("h1",{children:"Your current location:"}),(0,z.jsxs)("p",{children:["Latitude: ",X.lat," "]}),(0,z.jsxs)("p",{children:["Longitude: ",X.lng]})]}),placement:"right",color:"#87d068",children:(0,z.jsx)(h.Z,{icon:(0,z.jsx)(j.Z,{})})}),(0,z.jsx)(h.Z.BackTop,{visibilityHeight:0})]}),(0,z.jsxs)(h.Z.Group,{shape:"circle",style:{right:50,top:"60%",transform:"translateY(-50%)"},children:[te?(0,z.jsx)(h.Z,{icon:(0,z.jsx)(w.Z,{}),tooltip:"Hide Paths",onClick:at}):(0,z.jsx)(h.Z,{icon:(0,z.jsx)(T.Z,{}),tooltip:"Show Paths",onClick:at}),(0,z.jsx)(h.Z,{icon:(0,z.jsx)(Z.Z,{}),tooltip:"Add a Point",onClick:function(){var e=X.lat,t=X.lng;d.Z.confirm({title:"Set a New Marker",content:(0,z.jsxs)("div",{children:["Marker icon:",(0,z.jsx)(O.Z,{rotationSlider:!0,zoomSlider:!0,quality:1,cropShape:"round",children:(0,z.jsx)(p.Z,{customRequest:Je,listType:"picture-circle",onPreview:Ue,onChange:et,children:$e})}),"Comment:",(0,z.jsx)(D.Z,{showCount:!0,maxLength:200,style:{heght:250,marginBottom:24},placeholder:"Input something...",onChange:function(e){return Ce.current=e.target.value}}),"Pictures:",(0,z.jsx)(O.Z,{children:(0,z.jsx)(p.Z,{listType:"picture-card",onPreiew:Ue,onChange:et,children:Oe?(0,z.jsx)("img",{src:Oe,alt:"avatar",style:{width:"100%"}}):$e})})]}),onOk:function(n){A.Z.get("".concat(we,"/api/icon/").concat(be.current)).then((function(n){if("0"===n.data.code){console.log(n.data.data);var o=n.data.data;Se.current="data:image/png;base64,".concat(o),console.log(Se.current);var a={url:Se.current,scaledSize:new google.maps.Size(64,64)},l={markerLat:e,markerLng:t,type:"custom",markerID:Date.now(),name:ke,text:Ce.current,url:a,icon:be.current,pathID:""};console.log(l),V((function(e){return[].concat((0,r.Z)(e),[l])})),je(ke+1),console.log("Add an information point")}else console.log("Icon not found")})).catch((function(e){console.error("Error fetching icon data:",e)})),n()}})},disabled:!B}),(0,z.jsx)(h.Z,{icon:(0,z.jsx)(C.Z,{}),tooltip:"Clear",onClick:function(){P([]),V([]),je(1),Y(0),Fe([])},disabled:B}),(0,z.jsx)(h.Z,{icon:(0,z.jsx)(b.Z,{}),tooltip:"Take Screenshot",onClick:lt,disabled:Xe}),(0,z.jsx)(h.Z,{icon:(0,z.jsx)(S.Z,{}),tooltip:"Share",onClick:st,disabled:Xe})]})]})}):(0,z.jsx)("div",{children:"Loading.."})}}}]);
//# sourceMappingURL=941.f9216c56.chunk.js.map