"use strict";(self.webpackChunktravel_app=self.webpackChunktravel_app||[]).push([[957],{5682:function(e,t,a){a(2791);t.Z=a.p+"static/media/flaggreen.0d04a2a14a4cda256aa08ab3061b4a28.svg"},2741:function(e,t,a){a(2791);t.Z=a.p+"static/media/flagred.7ce369b6a269d5ef47359565b2ded2dc.svg"},8957:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var n=a(3433),r=a(9439),o=a(2791),c=a(7689),i=a(3655),s=a(7027),l=a(2962),d=a(6005),u=a(7309),p=a(8715),h=a(7993),g=a(573),f=a(17),m=a(1243),v=(a(870),a(5682)),x=a(2741),j=a(184),Z=function(e){var t=e.pathId,a=(0,o.useState)(null),n=(0,r.Z)(a,2),c=n[0],i=n[1],s=(0,o.useState)([]),l=(0,r.Z)(s,2),d=l[0],u=l[1],p=(0,o.useState)(15),Z=(0,r.Z)(p,2),w=Z[0],y=(Z[1],(0,o.useState)(!1)),k=(0,r.Z)(y,2),S=k[0],b=k[1],C=(0,o.useRef)(""),N=(0,h.Db)({googleMapsApiKey:"AIzaSyAwnNq68eny2SDMxe4og-nRYvrB_jXAP-g"}).isLoaded,P="http://localhost:90";(0,o.useEffect)((function(){m.Z.get("".concat(P,"/api/share/").concat(t)).then((function(e){i(e.data.data),console.log("Successfully retrive shared path:",e.data.data)})).catch((function(e){console.error("Error retrieving shared path:",e)})),m.Z.get("".concat(P,"/api/share/marker/").concat(t)).then((function(e){console.log(e.data.data);var t=e.data.data;Promise.all(t.map((function(e){return m.Z.get("".concat(P,"/api/icon/").concat(e.icon)).then((function(t){if("0"===t.data.code){console.log("Marker data get successfully",t.data);var a=t.data.data,n={url:"data:image/png;base64,".concat(a),scaledSize:new window.google.maps.Size(64,64)};e.url=n}})).catch((function(e){console.log("Error getting marker icon from the backend:",e)}))}))).then((function(){u(t),b(!0)}))})).catch((function(e){console.error("Error retrieving shared markers:",e)}))}),[t]);var E=function(e){e.marker;var t=e.pictureDataGroup;e.inputText;return(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{children:["Text: ",C.current]}),(0,j.jsx)("br",{}),"Pictures:",(0,j.jsx)("div",{children:(0,j.jsx)(g.Z.PreviewGroup,{preview:{onChange:function(e,t){return console.log("current index: ".concat(e,", prev index: ").concat(t))}},children:t.map((function(e,t){return(0,j.jsx)(g.Z,{width:100,src:"data:image/png;base64,".concat(e)},t)}))})})]})},z=function(e,t){f.Z.confirm({title:"The marker you left in this place",content:(0,j.jsx)(E,{marker:e,pictureDataGroup:t},(new Date).getTime()),onOk:function(e){e()}})};if(!c||!S||!N)return(0,j.jsx)("div",{children:"Loading..."});var A={lat:c.path[0].lat,lng:c.path[0].lng},I=c.path,D=I[0],L=I[I.length-1];return N?(0,j.jsx)("div",{className:"map-view",children:(0,j.jsx)("div",{className:"map-container",children:S&&N&&(0,j.jsxs)(h.b6,{center:A,zoom:w,mapContainerClassName:"map-container",children:[(0,j.jsx)(h.dp,{path:I,options:{strokeColor:"#5900FF",strokeOpacity:1,strokeWeight:5}}),d.map((function(e){return(0,j.jsx)(h.jC,{position:{lat:e.markerLat,lng:e.markerLng},icon:e.url,onClick:function(){return function(e){console.log("marker text is:"+e.text),C.current=e.text;var t=e.picture.map((function(e){return m.Z.get("".concat(P,"/api/picture/").concat(e)).then((function(e){return"0"===e.data.code?e.data.data:(console.log("Picture not found"),null)})).catch((function(e){return console.error("Error fetching picture data:",e),null}))}));Promise.all(t).then((function(t){var a=t.filter((function(e){return null!==e}));z(e,a)}))}(e)}},e.id)})),(0,j.jsx)(h.jC,{position:D,icon:{url:v.Z,scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(0,32)}}),(0,j.jsx)(h.jC,{position:L,icon:{url:x.Z,scaledSize:new window.google.maps.Size(32,32)}})]})})}):(0,j.jsx)("div",{children:"Loading.."})},w=i.Z.Title,y=i.Z.Paragraph;function k(){var e=localStorage.getItem("user")||"{}",t=JSON.parse(e),a="http://localhost:90",i=(0,c.UO)().postId,h=(0,o.useState)(""),g=(0,r.Z)(h,2),f=g[0],v=g[1],x=(0,o.useState)(null),k=(0,r.Z)(x,2),S=k[0],b=k[1],C=(0,o.useState)(!0),N=(0,r.Z)(C,2),P=N[0],E=N[1],z=(0,o.useState)([]),A=(0,r.Z)(z,2),I=A[0],D=A[1],L=function(){m.Z.get("".concat(a,"/api/post/").concat(i)).then((function(e){if("0"===e.data.code){var t;console.log(e.data);var r=e.data.data,o=null!==(t=e.data.data.comments)&&void 0!==t?t:[],c=m.Z.get("".concat(a,"/img/").concat(r.avatarid)).then((function(e){if("0"===e.data.code){var t=e.data.data;r.avatar="data:image/png;base64,".concat(t)}})).catch((function(e){console.error("Error fetching post avatar:",e)})),i=o.map((function(e){return m.Z.get("".concat(a,"/api/avatar/").concat(e.userid)).then((function(t){if("0"===t.data.code){var a=t.data.data;e.avatar="data:image/png;base64,".concat(a)}})).catch((function(e){console.error("Error fetching user avatar:",e)}))}));Promise.all([c].concat((0,n.Z)(i))).then((function(){o.sort((function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)})),b(r),D(o)})).catch((function(e){console.error("Error fetching user avatars:",e)}))}else console.log(e.data.msg);E(!1)})).catch((function(e){console.error("Error fetching post data:",e),E(!1)}))};(0,o.useEffect)((function(){L()}),[]);return P||!S?(0,j.jsx)("div",{children:"Loading..."}):(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{className:"post-title",style:{textAlign:"left"},children:(0,j.jsx)(w,{level:2,children:S.title})}),(0,j.jsxs)("div",{className:"avatar-info-container",style:{display:"flex",alignItems:"center"},children:[(0,j.jsx)("div",{className:"avatar-container",style:{marginRight:"16px"},children:(0,j.jsx)(l.C,{src:S.avatar,size:64})}),(0,j.jsx)("div",{className:"post-username",children:(0,j.jsx)(w,{level:4,children:S.username})})]}),(0,j.jsx)("div",{className:"post-content",style:{textAlign:"left"},children:(0,j.jsx)(y,{children:S.content})}),(0,j.jsx)("div",{className:"post-map",children:(0,j.jsx)(Z,{pathId:S.pathid})}),(0,j.jsx)(d.Z.TextArea,{value:f,onChange:function(e){return v(e.target.value)},rows:4,placeholder:"Enter your reply..."}),(0,j.jsx)("div",{className:"post-button",children:(0,j.jsx)(u.ZP,{onClick:function(){var e={content:f,userid:t.id,username:t.username,avatarid:t.avatarUrl};m.Z.post("".concat(a,"/api/post/").concat(i,"/reply"),e).then((function(e){console.log(e.data),s.ZP.success("Reply added successfully!"),v(""),L()})).catch((function(e){console.error("Error adding reply:",e),s.ZP.error("Failed to add reply. Please try again later.")}))},children:"Reply"})}),0===I.length?(0,j.jsx)("div",{className:"post-noreply",children:" No replies yet "}):(0,j.jsx)(p.Z,{pagination:{position:"bottom",align:"center"},dataSource:I,renderItem:function(e){return(0,j.jsx)(p.Z.Item,{children:(0,j.jsx)(p.Z.Item.Meta,{avatar:(0,j.jsx)(l.C,{src:e.avatar}),title:e.username,description:e.content})})}})]})}},870:function(){}}]);
//# sourceMappingURL=957.d0a774fd.chunk.js.map